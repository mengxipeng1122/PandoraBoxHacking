<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>gamelist</title>
    
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans|Candal|Alegreya+Sans">
    <link rel="stylesheet" type="text/css" href="css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/imagehover.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>

  <body>

<ul class="nav nav-pills" id='DBLinkbutton'>
</ul>
<!--
  <li class="active"><a href="#">Home</a></li>
  -->

  <table class="table table-bordered">
  <caption id='caption'></caption>
  <thead>
  <tr id='DBgametableHeader'>
  <th>#</th>
  <th>Name</th>
  <th>Preview</th>
  </tr>
  </thead>
  <tbody id='DBgametable'>
  <!--
  <tr>
  <td>Tanmay</td>
  <td>Bangalore</td>
  <td>560001</td>
  </tr>
  <tr>
  <td>Sachin</td>
  <td>Mumbai</td>
  <td>400003</td>
  </tr>
  <tr>
  <td>Uma</td>
  <td>Pune</td>
  <td>411027</td>
  </tr>
  -->
  </tbody>
  </table>

  <ul class="pagination" id='DBpage'>
  <!--
  <li><a href="#">&laquo;</a></li>
  <li class="active"><a href="#">1</a></li>
  <li><a href="#">2</a></li>
  <li><a href="#">3</a></li>
  <li><a href="#">4</a></li>
  <li><a href="#">5</a></li>
  <li><a href="#">&raquo;</a></li>
  -->
  </ul>


    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>

  <script>

  var prodidx=0;
  var startgameidx=0
  var gamecount=20
  var onepage=false;
  var alphabetsort=false;
  
  function getQueryString(name) { 
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
    var r = location.search.substr(1).match(reg); 
    if (r != null) return unescape(decodeURI(r[2])); return null; 
  } 

function readTextFile(file, callback)
{
  var rawFile = new XMLHttpRequest();
  rawFile.overrideMimeType("application/json");
  rawFile.open('GET', file, true);
  rawFile.onreadystatechange=function(){
    if(rawFile.readyState===4 && rawFile.status=='200')
    {callback(rawFile.responseText);}
  }
  rawFile.send(null);
}

function setPagination(prodidx,alphabetsort,startidx, pagecount, totalLength)
{
  var slibingpagecount=4;

  $('#DBpage').append( '<li><a href="gamelist.html?prodidx='+prodidx+'&startgameidx='+0+'&gamecount='+gamecount+'&alphabetsort='+alphabetsort+'">&laquo;</a></li>' )
  for( var i=0;i<slibingpagecount;i++)
  {
    var pageidx=startidx-(slibingpagecount-i)*gamecount;
    if(pageidx<0)continue;
    $('#DBpage').append( '<li><a href="gamelist.html?prodidx='+prodidx+'&startgameidx='+pageidx+'&gamecount='+gamecount+'&alphabetsort='+alphabetsort+'">'+(Math.floor(pageidx/gamecount)+1)+'</a></li>' )
  }
  $('#DBpage').append( '<li class="active"><a href="gamelist.html?prodidx='+prodidx+'&startgameidx='+startidx+'&gamecount='+gamecount+'&alphabetsort='+alphabetsort+'">'+(Math.floor(startidx/gamecount)+1)+'</a></li>' )
  for( var i=0;i<slibingpagecount;i++)
  {
    var pageidx=startidx+(i+1)*gamecount;
    if(pageidx>=totalLength-1)continue;
    $('#DBpage').append( '<li><a href="gamelist.html?prodidx='+prodidx+'&startgameidx='+pageidx+'&gamecount='+gamecount+'&alphabetsort='+alphabetsort+'">'+(Math.floor(pageidx/gamecount)+1)+'</a></li>' )
  }
  var totalpage = Math.floor(totalLength/pagecount)+1;
  $('#DBpage').append( '<li><a href="gamelist.html?prodidx='+prodidx+'&startgameidx='+(totalpage-1)*pagecount+'&gamecount='+gamecount+'&alphabetsort='+alphabetsort+'">&raquo;</a></li>' )


}
function setTable(games, onepage)
{
  if(onepage)
  {
    $('#DBgametableHeader').html(
    '<th>#</th>           '
  + '<th>Name</th>        '
    )
  }
  else
  {
    $('#DBgametableHeader').html(
     '<th>#</th>           '
   + '<th>Name</th>        '
   + '<th>Preview</th>        '
    )
  }
  for (var i=0;i<games.length;i++)
  {
    var game  = games[i]
    var html;
    if(onepage)
    html = 
            '<tr>                 '
          + '<td>'+game.idx+'</td>      '
          + '<td><a href="http://adb.arcadeitalia.net/dettaglio_mame.php?game_name='+game.rom+'">'+game.name+'</a></td>   '
          + '</tr>                '
          ;
    else
    html = 
            '<tr>                 '
          + '<td>'+game.idx+'</td>      '
          + '<td><a href="http://adb.arcadeitalia.net/dettaglio_mame.php?game_name='+game.rom+'">'+game.name+'</a></td>   '
          //+ '<td><li><a href="http://adb.arcadeitalia.net/dettaglio_mame.php?game_name='+game.rom+'" ><img src="http://adb.arcadeitalia.net/media/mame.current/ingames/'+game.rom+'.png"/>_<h1>'+game.rom+'</h1></a></li></td>      '
          + '<td><img src="http://adb.arcadeitalia.net/media/mame.current/ingames/'+game.rom+'.png"/></td>      '
          + '</tr>                '
          ;
      $('#DBgametable').append(html)
  }
}
$(document).ready(function() {
  var val;
  val = getQueryString('prodidx');
  if(val) prodidx = parseInt(val);
  val = getQueryString('startgameidx')
  if(val) startgameidx=parseInt(val);
  val = getQueryString('gamecount')
  if(val) gamecount=parseInt(val);
  val = getQueryString('alphabetsort')
  if(val) alphabetsort=val=='true';
  val = getQueryString('onepage')
  if(val) onepage=val=='true';

  console.log('prodidx '       +  prodidx       );
  console.log('startgameidx '  +  startgameidx  );
  console.log('gamecount '     +  gamecount     );
  console.log('alphabetsort '  +  alphabetsort  );

  

  readTextFile('db.json', function (text){
    var db = JSON.parse(text);
    var gamelist = db.prods[prodidx]['gamelist']
    var games=[]
    var prod = db.prods[prodidx]
    // set linkbutton 
    if(onepage)
    {
      var link = 'gamelist.html?prodidx='+prodidx+'&startgameidx='+0+'&gamecount='+gamecount+'&alphabetsort='+alphabetsort+'&onepage=false';
      $('#DBLinkbutton').append( '<li class="active"><a href="'+link+'">Pagination</a></li>' );
      $('#DBLinkbutton').append( '<li class="active"><a href="index.html">Main page</a></li>' );
    }
    else
    {
      var link = 'gamelist.html?prodidx='+prodidx+'&startgameidx='+0+'&gamecount='+gamecount+'&alphabetsort='+alphabetsort+'&onepage=true';
      $('#DBLinkbutton').append( '<li class="active"><a href="'+link+'">Onepage</a></li>' );
      $('#DBLinkbutton').append( '<li class="active"><a href="index.html">Main page</a></li>' );
    }
    // set capition
    $('#caption').html(prod.name)

    if(onepage)
    {
      for(var i = 0;i<gamelist.length;i++)
      {
        var rom = gamelist[i];
        games[i]=({idx:i+1,name: db.gamelib[rom].name, rom:rom});
      }
    }
    else
    {
      for(var i = startgameidx;i<startgameidx+gamecount && i<gamelist.length;i++)
      {
        var rom = gamelist[i];
        games[i-startgameidx]=({idx:i+1,name: db.gamelib[rom].name, rom:rom});
      }
    }
    
    setTable(games, onepage);
    if (onepage)
    {}
    else
    setPagination(prodidx,alphabetsort,startgameidx, gamecount, gamelist.length);

  });

});

  </script>
  </body>
</html>
